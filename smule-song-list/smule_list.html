<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Smule: List of Songs</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <link rel="stylesheet" href="..\lumen.css">
</head>




<body>

<!-- CONTENT STUFF -->
<div class="container">
    <div class="row mb-2 mt-5">
        <div class="col-md-12">
          <div class="row no-gutters border rounded overflow-hidden flex-md-row mb-4 shadow-sm h-md-250 position-relative">
            <div class="col p-4 d-flex flex-column position-static">
              <h2 class="pb-3 pt-3 text-primary"><strong>All Songs We Sang Together in Smuleüé§</strong></h2>
              <div class="row">
                <div class="col">
                  
                  <!-- NAV BAR CONTENT-->
                  <ul class="nav nav-tabs">
                    <li class="nav-item">
                      <a class="nav-link active" data-toggle="tab" href="#home">Intro</a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link" data-toggle="tab" href="#extract">Extract</a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link" data-toggle="tab" href="#transform">Transform</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#analysis">Analysis</a>
                    </li>
                  </ul>

                  <!-- Home -->
                  <div id="myTabContent" class="tab-content">
                    <div class="tab-pane fade active show" id="home">
                      <p><h5 class='text-secondary'><strong>Quick Background</strong></h5>
                        <a href="https://www.smule.com/" target="_blank">Smule</a> is a social singing app that I use to sing 
                        with other people around the world. I am quite active in it for various reason, but I wouldn't go so far to say that I am <a href="https://www.netflix.com/title/80198505" target="_blank">Retsuko</a> in real-life. 
                        My bestie does like to think that way though üòú</p>
                      <p><h5 class='text-secondary'><strong>Motivation</strong></h5>
                        <p>After singing togehter with the same people for a few years, I couldn't help thinking, <i class='text-danger'>'How many songs have we sung together in total? What have we sung so far?'</i> Unfortunately, Smule -just like any other social media- does not
                            really give you a year-end report like how you would get your credit card usage statementüòÇ</p>
                        <div class="row mb-3">
                          <div class="col-6">
                            <a><img class="rounded mx-auto d-block" src="asset/smule_page.PNG" alt="smule_page" width="85%"></a>
                          </div>
                          <div class="col-6">
                            <p>To get the songs listed on the page in Smule is quite endless. You have to scroll through the page. As you scroll down, the page will give more content until you hit the first song you have ever sung. 
                              Imagine there's over 1000s of songs on your page and the page shows only 25 at a time...and your internet suddenly crashes‚ò† <i>You get the idea, right?</i></p>
                            <p>Now let's say you were really passionate about finding the list of all songs and scrolled through those 100s of pages (FYI: Even I don't do that!), 
                              you will probably have to <i>copy + paste</i> the specific item on the page into some sort of a spreadsheet field by field and one by one.
                              You can pay an intern to do this for months. Or just let the code do it for youü§ì</p>
                            <p>Yes, I am very obssessed with getting those data! What could be better than using my own singing data to demonstrate my coding skills AND my personal life interest!?</p>
                            <h5 class='text-muted'><strong>Skills to show off</strong></h5>
                            <ul>
                              <li>Python: Libraries used include json, pandas and requests</li> 
                              <li>PostgreSQL: Database of my choice</li>
                              <li>SQL: Running queries</li>
                              <li>Jupyter notebook: Where I ran all my python code</li>
                            </ul>
                          
                          </div>
                        </div>
                        <p> <h5 class='text-secondary'><strong>Goal</strong></h5>
                        <p>I am going to turn this blob of information to a nice table and run some analysis with it ( ‚Ä¢ÃÄ œâ ‚Ä¢ÃÅ )‚úß</p>
                        <div class="row mb-2">
                            <div class="col-4">
                              <h5 class="text-center text-success">Blob of Info</h5>
                              <div class="text-center pb-2">
                              <a><img src="asset/json_blob.PNG" alt="json_blob" width="100%"></a>
                              </div>
                            </div>
                            <div class="col-8">
                              <div class="text-center pb-2">
                              <h5 class="text-center text-success">Nice Table</h5>
                              <a><img src="asset/song_table.png" alt="smule-song-table" width="100%"></a>
                              </div>
                            </div>
                        </div>
                        <p class="text-right" ><i>All those years of working in clinical research and patient's confidentiality sure drilled me good with PII redaction skills</i> üòâ</p>

                    </div>
                    <!-- EXTRACT -->
                    <div class="tab-pane fade" id="extract">
                      <p><h5 class='text-secondary'><strong>Data Fishing</strong></h5> 
                      <p>Trying to get my hands on the data was actually the hardest part of this project. Here's my journey:</p>
                      <ul>
                        <li><i>Any API request? Nope... Okay, fine.</i></li> 
                        <li><i>No year-end report in any format? </i></li>
                        <li><i>Web scraping with BeautifulSoup (python): ...code can't be soupify...</i></li>
                        <li><i>Alright I'm gonna stop wasting time lamenting. Moving on..</i> MORE GOOGLE!</li>
                      </ul>
                      <p>From googling around, I finally got my hands on the URL where I can get the data I need in a json format. Bless those beautiful souls for sharing the URL on <a href="https://stackoverflow.com/questions/50074596/list-of-followers-and-recordings-of-smule" target="_blank"> stackoverflow</a> and
                        <a href="https://sing.salon/forums/topic/614-introducing-sing-insights-beta/" target="_blank"> Sing Salon</a>.</p>
                      <strong class='text-muted'>STARTER URL ACQUIRED</strong>‚ú®
                      <p class='text-success'>https://www.smule.com/s/profile/performance/&lt;username&gt;/sing?offset=&lt;#&gt;</p>  
                      <p><h5 class='text-secondary'><strong>Parsing-out JSON Object</strong></h5> 
                      <p>Let the cherry-picking begins!</p>
                      <div class="row mb-2">
                        <div class="col-6">
                          <div class="text-center pb-2">
                            <a><img src="asset/extract.PNG" alt="json_request" width="85%"></a>
                          </div>
                        </div>
                        <div class="col">
                          <div>
                            For my own purpose, I am only interested in the following filed:
                            <ul>
                              <li>"title"</li> 
                              <li>"artist" (looks like the song uploader didn't specify artist for this one)</li>
                              <li>"created_at"</li>
                              <li>"web_url"</li>
                              <li>"performed_by (not shown here)"</li>
                            </ul>
                            <p>I actually created a project on my GitHub that is dedicated for extracting data [and transforming too].</p>
                            <button type="button" class="btn btn-outline-warning"><a href="https://github.com/ckunakom/smule-song-list" target="_blank">Data Extraction Code!</a></button>
                            <p></p>
                            <p><i>I am intentionally redacting more than just the values, getting a bit paranoid</i> üòÖ</p>
                            <p></p>
                          </div>
                        </div>
                      </div>
                      <p><h5 class='text-secondary'><strong>Multiple Issues...</strong></h5> 
                      <p>Unfortunately, the code that I shared for Data Extraction does not always work on the first go. I was able to run the whole notebook in one-go
                        one day, the 2nd loop got an error on another. Also, each time I ran the code, I will have to wait at least 30 minutes before I ran the same <i>request</i> code and I would not be able to have access to Smule page for similar amount
                        (got a 418 Error Code). Until now, I still couldn't figure out how to bypass the rate limitation on making request for the json data. I added errors & exceptions which seemed to work, 
                        but later on gave the same result as the code without <i>try-except</i>. I tried adding <i>time.sleep(2)</i> and that didn't do anything either.
                      
                      <p>As a last resort, instead of making two requests (2 usernames, 2 URLs) in the same notebook I made only 1 request on just 1 username.
                        I exported the output to csv, waited 30 minutes to restart & rerun the code with the 2nd username, and exported that 2nd csv. Then, I appended 
                        the two dataframes and reset the index (need to do this for SQL database) before exporting that final dataframe to csv to be loaded. A whole set of jupyter notebooks were created for this alternative method.
                        <i>Yeah, I know. I AM obssessed with getting these data.</i> Imagine how many 30-min-wait time I had to do while debugging... üò≠ </p>
                      
                    <!-- Transform -->
                    </div>
                    <div class="tab-pane fade" id="transform">
                      <p><h5 class='text-secondary'><strong>Cleaning Up</strong></h5> 
                      <p>Most of the data returned is actually pretty clean, but I want the data to get spit out in a certain way. 
                        I tweaked the output of the two fields: date ("created_at") and web URL ("web_url"). 
                      <p>Instead of having the date and timestamp (stalkable metric right there üò±), I only want a return of just the date:<br>
                        <ul>
                          <li>"2020-08-16T20:54:36-07:00" ‚Üí "2020-08-16"</li>
                        </ul>
                      </p>
                      <p>The web URL returned is only part of the url. I want a full URL:<br>
                        <ul>
                          <li>"/recording/asca-koe-tv-size/ü§êü§êü§ê/" ‚Üí "https://www.smule.com/recording/asca-koe-tv-size/ü§êü§êü§ê/"</li>
                        </ul>
                      </p>
                      <p><h5 class='text-secondary'><strong>Extra Clean-up</strong></h5>
                      <p>I did an extra clean-up step to replace the real date with a fake one and to also replace the actual username with just '-username-' üôÑ</p>
                      <p><h5 class='text-secondary'><strong>Creating Dataframeüêº</strong></h5> 
                      <p>Once all the data is in the format I want, it's time for pandas to shine!</p>
                      <div class="text-center pb-2">
                        <a><img src="asset/transform.PNG" alt="transform_table" width="85%"></a>
                      </div>
                      <p><h5 class='text-secondary'><strong>Write to CSV</strong></h5> 
                      <p>I ran the code to import the dataframe to csv as opposed to using SQLAlchemy to create engine and connection to postgreSQL 
                        -Sorry if this got anti-climaticüëÄ Anyhow!
                        <strong class='text-muted'>NICE TABLE ACQUIRED</strong>‚ú®
                      </p>
                    
                    </div>
                    <div class="tab-pane fade" id="analysis">
                      <!-- SQL schema -->
                      <p><h5 class='text-secondary'><strong>Setting up Database</strong></h5> 
                      <p>Again, I use postgreSQL as my database to run my SQL query. I created a database within pgAdmin before creating a table with the following code before I imported my csv:</p>
                      <a><img src="asset/load.PNG" alt="load_table" width="85%"></a>
                      <p>Once the data has been dumped, it's time to go to town with it! ‚úä</p>
                      <p><h5 class='text-secondary'><strong>Query</strong></h5>
                      <p><i>Oh my gosh!</i> I am finally getting my long-awaited resultsü§© Here are some of the queries I ran:</p>
                      <a><img src="asset/query.PNG" alt="query" width="50%"></a>
                    </div>

                  </div>
                
                
                </div>
              </div> 
            </div>
          </div>
        </div>
        

</div>















    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.miJujubes carrot cake chocolate cake cupcake toffee cupcake pudding fruitcake chupa chups. Toffee lollipop cupcake. Danish caramels macaroon lemon drops candy canes.n.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    
    </body>
    
    </html>
           